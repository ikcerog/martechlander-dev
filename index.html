<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Dashboard</title>
    <style>
        /* --- STYLES (KEEP ALL YOUR EXISTING CSS HERE) --- */

        /* Example styles for the new toggle button (integrate with your existing .control-button) */
        .controls-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        /* Adjustments for the new header structure */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-top h1 {
            flex-grow: 1;
        }

        .view-button {
            /* Example: group view buttons */
        }
        
        /* Your existing styles for the dashboard, news cards, grid, list view, theme, etc. */
        
        /* Ensure AI summary content renders markdown well */
        #ai-summary-content h2, #ai-summary-content h3 {
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        #ai-summary-content ul {
            padding-left: 20px;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body>

<header>
    <div class="header-content">
        <div class="header-top">
            <h1>üè° DEV üíµ Residential Mortgage Feed</h1>
            
            <button id="feed-mode-toggle" class="control-button" onclick="toggleFeedMode()">Switch to AdTech Feed</button>
            
            <button id="theme-toggle" class="control-button" onclick="toggleTheme()">‚òÄÔ∏è Switch to Dark Mode</button>
        </div>
        
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Search for rates, regulation, companies (Rocket, UWM...)..." onkeyup="filterCards()">
        </div>
        
        <div class="controls-row">
            <button id="toggle-filter-bar-btn" class="control-button" onclick="toggleFilterBar()">Hide Filter Bar</button>

            <div id="view-toggle-row">
                <button id="grid-view-button" class="view-button control-button" onclick="setListView('grid')">Grid View</button>
                <button id="list-view-button" class="view-button control-button" onclick="setListView('list')">List View</button>
            </div>
            
            <button id="reset-hidden-button" class="control-button" onclick="resetHiddenTiles()">Reset Hidden Tiles</button>
        </div>
        
        <div id="filter-bar-container">
            <button id="toggle-core-mortgage" class="control-button active" data-target="core-mortgage-news" onclick="toggleSection(this)">Core News & Rates</button>
            <button id="toggle-housingwire-authors" class="control-button active" data-target="housingwire-authors" onclick="toggleSection(this)">HW: Key Authors</button>
            <button id="toggle-company-news" class="control-button active" data-target="company-news-tags" onclick="toggleSection(this)">Company Focus</button>
            <button id="toggle-real-estate-economy" class="control-button active" data-target="real-estate-market" onclick="toggleSection(this)">Real Estate & Economy</button>
            <button id="toggle-regulation" class="control-button active" data-target="regulation-compliance" onclick="toggleSection(this)">Regulation & CFPB</button>
            <button id="toggle-fintech-finance" class="control-button active" data-target="finance-fintech" onclick="toggleSection(this)">FinTech & Finance</button>
            <button id="toggle-community" class="control-button active" data-target="community-pulse-feed" onclick="toggleSection(this)">Community Pulse</button>
        </div>
    </div>
</header>

<details open="open" style="margin: 8px auto; max-width: 1400px; padding: 16px; box-shadow: 0 0 4px #33333333; border-radius: 8px;"><summary>Click to Hide/Show AI Summary</summary>
<div id="ai-insight-panel" class="feed-section">
    <div id="ai-summary-header">
        <h2>‚ú® AI Strategy Summary [Slowed in DEV]</h2>
        <button id="copy-summary-button" onclick="copyAISummary()" title="Copy the full AI Summary to your clipboard" disabled>Copy Summary</button>
    </div>
    
    <div id="ai-summary-status">
        </div>
    
    <div id="ai-summary-content">
        <p>AI summary is slowed in DEV to preserve resources</p>
    </div>
</div>
</details>

<div id="core-mortgage-news" class="feed-section">
    <h2>üìà Core Mortgage News & Rates (MND, HousingWire, NMN)</h2>
    <div class="news-grid-container" data-feed-id="core-mortgage-news">
        <div class="news-grid">Loading Core Mortgage News...</div>
    </div>
</div>
<div id="community-pulse-feed" class="feed-section">
    <h2>üó£Ô∏è Community Pulse (Reddit: r/Mortgage, r/FTHB, r/REI)</h2>
    <div id="community-pulse-container">
    </div>
</div>
    
<script>
    /* --- JavaScript for Theme Switching, Fetching, Rendering, and Controls --- */

    // --- BLACKLIST KEYWORDS ---
    const BLACKLIST_KEYWORDS = [
        "coupon code:",
        "promo code:",
        "discount offer:",
        "save now",
        "limited time deal",
        "free trial",
        "get 50%"
    ];

    // --- FEED ARRAYS ---
    const MORTGAGE_FEEDS = [
        // --- CORE MORTGAGE INDUSTRY NEWS & RATES ---
        { id: 'core-mortgage-news', url: 'https://www.mortgagenewsdaily.com/rss/all.aspx', source: 'Mortgage News Daily' },
        { id: 'core-mortgage-news', url: 'https://www.housingwire.com/feed/', source: 'HousingWire (General)' },
        { id: 'core-mortgage-news', url: 'https://www.nationalmortgagenews.com/rss/headlines.xml', source: 'National Mortgage News (Headlines)' },
        { id: 'core-mortgage-news', url: 'https://www.nationalmortgagenews.com/feed?rss=true', source: 'NMN (The Latest Feed)' },

        // --- AUTHOR & SPECIFIC HOUSINGWIRE COVERAGE (User Requested) ---
        { id: 'housingwire-authors', url: 'https://www.housingwire.com/author/Connie-Kim/feed/', source: 'HousingWire: Connie Kim' },
        { id: 'housingwire-authors', url: 'https://www.housingwire.com/author/James-Kleimann/feed/', source: 'HousingWire: James Kleimann' },
        { id: 'housingwire-authors', url: 'https://www.housingwire.com/author/Flavia-Furlan-Nunes/feed/', source: 'HousingWire: Fl√°via Nunes' },
        { id: 'company-news-tags', url: 'https://www.housingwire.com/tag/rocket-mortgage/feed/', source: 'HousingWire: Rocket Mortgage Tag' },

        // --- COMPANY PRESS RELEASES (User Requested) ---
        { id: 'company-press-releases', url: 'https://www.rocketcompanies.com/feed/?post_type=press_release', source: 'Rocket Companies PR' },
        { id: 'company-press-releases', url: 'https://feed.businesswire.com/rss/home/company/United+Wholesale+Mortgage%2C+LLC/w6euAGJXjezVpz22AaGCsA==?_gl=1*16nikhv*_gcl_au*MzE3OTYyNzg4LjE3MjQ3NjUwMjM.*_ga*MTI5NTUzNDI3OS4xNzI0NzY1MDIz*_ga_ZQWF70T3FK*MTcyNjA2NzQyNC4zLjEuMTcyNjA2NzQzOS40NS4wLjA.', source: 'UWM Business Wire' },

        // --- REAL ESTATE MARKET & ECONOMIC INFLUENCERS ---
        { id: 'real-estate-market', url: 'https://www.calculatedriskblog.com/feeds/posts/default', source: 'Calculated Risk' },
        { id: 'real-estate-market', url: 'https://www.inman.com/feed/', source: 'Inman News' },
        { id: 'real-estate-market', url: 'https://www.dsnews.com/rss', source: 'DS News (Default Servicing)' },

        // --- REGULATION & COMPLIANCE ---
        { id: 'regulation-compliance', url: 'https://www.jdsupra.com/rss/browse.aspx?ftid=2334', source: 'JD Supra: Mortgage Law' },
        { id: 'regulation-compliance', url: 'https://www.consumerfinance.gov/about-us/newsroom/feed/', source: 'CFPB Newsroom' },

        // --- FINANCE, FINTECH, & INDUSTRY TECHNOLOGY ---
        { id: 'finance-fintech', url: 'https://techcrunch.com/category/fintech/feed/', source: 'TechCrunch: Fintech' },
        { id: 'finance-fintech', url: 'https://www.theblockcrypto.com/rss/feed/mortgage-fintech', source: 'The Block: Mortgage Fintech' },
        { id: 'finance-fintech', url: 'https://www.americanbanker.com/feeds/news', source: 'American Banker' },

        // --- OTHER (User Requested) ---
        { id: 'other-feeds', url: 'https://podcastfeeds.nbcnews.com/HL4TzgYC', source: 'Dateline NBC (Podcast)' },
    ];

    // *** IMPORTANT: REPLACE THIS PLACEHOLDER ARRAY with your actual AdTech feeds ***
    const ADTECH_FEEDS = [
        { id: 'core-adtech', url: 'https://www.adexchanger.com/feed/', source: 'AdExchanger' },
        { id: 'core-adtech', url: 'https://www.adweek.com/category/tech/feed/', source: 'AdWeek Tech' },
        { id: 'measurement', url: 'https://www.mediapost.com/rss/sections/20/', source: 'MediaPost Measurement' },
        { id: 'identity-privacy', url: 'https://www.iab.com/feed/', source: 'IAB News' },
        { id: 'core-adtech', url: 'https://www.martech.zone/feed/', source: 'MarTech Zone' },
        { id: 'measurement', url: 'https://www.digiday.com/feed/', source: 'Digiday' },
        // ... add the rest of your AdTech feed objects here
    ]; 
    // ********************************************************************************

    const REDDIT_FEEDS = [
        { id: 'r/realestateinvesting', url: 'https://www.reddit.com/r/realestateinvesting.rss' },
        { id: 'r/Mortgage', url: 'https://www.reddit.com/r/Mortgage.rss' },
        { id: 'r/FirstTimeHomeBuyer', url: 'https://www.reddit.com/r/FirstTimeHomeBuyer.rss' },
        { id: 'r/financialindependence', url: 'https://www.reddit.com/r/financialindependence.rss' },
        { id: 'r/personalfinance', url: 'https://www.reddit.com/r/personalfinance.rss' },
    ];

    // --- NEW STATE MANAGEMENT ---
    let currentFeedMode = 'mortgage'; // Default to mortgage
    const ALL_FEEDS = {
        'mortgage': { feeds: MORTGAGE_FEEDS, title: 'üè° DEV üíµ Residential Mortgage Feed' },
        'adtech': { feeds: ADTECH_FEEDS, title: 'üíª DEV üìä AdTech & MarTech Feed' }
    };

    // --- INITIALIZATION (Updated) ---
    document.addEventListener('DOMContentLoaded', () => {
        // Check local storage for mode, otherwise use default
        currentFeedMode = localStorage.getItem('currentFeedMode') || 'mortgage';
        updateHeaderAndButton(currentFeedMode);
        fetchAndRenderFeeds();
        checkInitialTheme();
        loadHiddenTiles();
        filterCards(); 
    });


    /**
     * Fetches RSS feeds from the server and renders the news cards.
     * Now uses the active feed array based on currentFeedMode.
     */
    async function fetchAndRenderFeeds() {
        // 1. CLEAR previous content
        document.querySelectorAll('.news-grid-container .news-grid').forEach(el => el.innerHTML = `Loading ${currentFeedMode === 'mortgage' ? 'Mortgage' : 'AdTech'} News...`);
        document.getElementById('community-pulse-container').innerHTML = '';
        
        const activeFeedSet = ALL_FEEDS[currentFeedMode].feeds;

        const rssUrls = activeFeedSet.map(feed => feed.url);
        const redditUrls = REDDIT_FEEDS.map(feed => feed.url);

        // Fetch RSS feeds
        try {
            const response = await fetch('/api/fetch-rss', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ urls: rssUrls })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            
            // Match fetched articles to their section IDs
            const sectionData = {};
            data.forEach(article => {
                const feedConfig = activeFeedSet.find(f => f.url === article.feedUrl);
                if (feedConfig) {
                    const sectionId = feedConfig.id;
                    if (!sectionData[sectionId]) {
                        sectionData[sectionId] = [];
                    }
                    sectionData[sectionId].push({ ...article, source: feedConfig.source });
                }
            });

            // Render to the DOM
            for (const sectionId in sectionData) {
                // Ensure we only try to render to containers that exist for the current mode
                const container = document.querySelector(`.news-grid-container[data-feed-id="${sectionId}"] .news-grid`);
                if (container) {
                    container.innerHTML = sectionData[sectionId].map(createCardHtml).join('');
                }
            }
            
            // After rendering, trigger the initial AI summary generation
            generateAISummary(); 

        } catch (error) {
            console.error('Error fetching RSS feeds:', error);
            document.querySelectorAll('.news-grid-container .news-grid').forEach(el => el.innerHTML = `<p class="error-message">Failed to load news: ${error.message}</p>`);
        }

        // Fetch Reddit Feeds (Always fetches the same set, but you can adjust this if needed)
        fetchRedditFeeds(redditUrls);
    }


    /**
     * NEW FUNCTION: Updates the Header and Toggle Button Text
     */
    function updateHeaderAndButton(mode) {
        const headerTitleEl = document.querySelector('.header-content h1');
        const toggleButton = document.getElementById('feed-mode-toggle');

        if (mode === 'mortgage') {
            headerTitleEl.textContent = ALL_FEEDS.mortgage.title;
            toggleButton.textContent = 'Switch to AdTech Feed';
        } else {
            headerTitleEl.textContent = ALL_FEEDS.adtech.title;
            toggleButton.textContent = 'Switch to Mortgage Feed';
        }
    }


    /**
     * NEW FUNCTION: Toggles the Feed Mode and Refreshes Content
     */
    function toggleFeedMode() {
        // Switch the mode
        currentFeedMode = currentFeedMode === 'mortgage' ? 'adtech' : 'mortgage';
        localStorage.setItem('currentFeedMode', currentFeedMode);
        
        console.log(`Switched to ${currentFeedMode} mode.`);

        // 1. Update the UI Text
        updateHeaderAndButton(currentFeedMode);

        // 2. Fetch and render the new feeds
        fetchAndRenderFeeds();

        // 3. Clear the search input
        document.getElementById('search-input').value = '';

        // 4. Reset hidden tiles (to ensure a clean slate for the new feed type)
        resetHiddenTiles(); 

        // 5. Scroll to the top
        window.scrollTo(0, 0); 
    }


    // --- KEEP YOUR EXISTING, UNCHANGED FUNCTIONS BELOW ---

    // The createCardHtml function 
    function createCardHtml(item) {
        // ... [YOUR ORIGINAL createCardHtml FUNCTION HERE] ...
        const keywordsMatched = BLACKLIST_KEYWORDS.some(keyword => 
            item.title.toLowerCase().includes(keyword) || 
            (item.description && item.description.toLowerCase().includes(keyword))
        );
        if (keywordsMatched) return '';

        // A basic unique ID based on a hash of the title and date for local storage
        const uid = btoa(item.title + item.pubDate).replace(/=/g, '').substring(0, 30);
        const isHidden = localStorage.getItem('hidden-' + uid) === 'true';
        const pubDate = new Date(item.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        return `
            <div class="news-card ${isHidden ? 'hidden' : ''}" data-uid="${uid}" data-source="${item.source}" data-date="${item.pubDate}">
                <div class="card-header">
                    <span class="card-source">${item.source}</span>
                    <span class="card-date">${pubDate}</span>
                </div>
                <h3><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a></h3>
                <p>${item.description}</p>
                <button class="hide-button control-button" onclick="hideTile(this.parentElement)">Hide Forever</button>
            </div>
        `;
    }

    // The renderRedditPosts function
    function renderRedditPosts(posts) {
        const container = document.getElementById('community-pulse-container');
        if (!container) return; 

        // Clear existing content
        container.innerHTML = ''; 

        // Group posts by subreddit
        const postsBySubreddit = posts.reduce((acc, post) => {
            if (!acc[post.subreddit]) {
                acc[post.subreddit] = [];
            }
            acc[post.subreddit].push(post);
            return acc;
        }, {});

        // Render each subreddit group
        for (const subreddit in postsBySubreddit) {
            const subredditTitle = document.createElement('h3');
            subredditTitle.textContent = `r/${subreddit} (${postsBySubreddit[subreddit].length} Recent Posts)`;
            container.appendChild(subredditTitle);

            const grid = document.createElement('div');
            grid.className = 'news-grid'; // Use news-grid for styling consistency
            grid.innerHTML = postsBySubreddit[subreddit].map(item => {
                // Generate UID and check hidden status for Reddit posts too
                const uid = btoa(item.title + item.link).replace(/=/g, '').substring(0, 30);
                const isHidden = localStorage.getItem('hidden-' + uid) === 'true';
                const pubDate = new Date(item.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

                // Reddit-specific description formatting
                let descriptionHtml = item.description || 'No description available.';
                
                return `
                    <div class="news-card ${isHidden ? 'hidden' : ''}" data-uid="${uid}" data-source="Reddit: ${item.subreddit}" data-date="${item.pubDate}">
                        <div class="card-header">
                            <span class="card-source">r/${item.subreddit}</span>
                            <span class="card-date">${pubDate}</span>
                        </div>
                        <h3><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a></h3>
                        <p class="reddit-description">${descriptionHtml}</p>
                        <button class="hide-button control-button" onclick="hideTile(this.parentElement)">Hide Forever</button>
                    </div>
                `;
            }).join('');
            container.appendChild(grid);
        }
    }

    // The fetchRedditFeeds function
    async function fetchRedditFeeds(urls) {
        try {
            const response = await fetch('/api/fetch-reddit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ urls: urls })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const posts = await response.json();
            renderRedditPosts(posts);

        } catch (error) {
            console.error('Error fetching Reddit feeds:', error);
            const container = document.getElementById('community-pulse-container');
            if (container) {
                container.innerHTML = `<p class="error-message">Failed to load Community Pulse: ${error.message}</p>`;
            }
        }
    }

    /**
     * UPDATED: Now sends the currentFeedMode to the server to select the right AI prompt.
     */
    async function generateAISummary() {
        const summaryHeader = document.getElementById('ai-summary-status');
        const summaryContent = document.getElementById('ai-summary-content');
        const copyButton = document.getElementById('copy-summary-button');

        // 1. Get the current AI Summary prompt type
        const summaryPromptType = currentFeedMode; // 'mortgage' or 'adtech'
        
        // Disable the copy button during generation
        copyButton.disabled = true;
        summaryHeader.innerHTML = '‚ú® **Generating new summary...** This may take 30-60 seconds...';
        summaryContent.innerHTML = '<p>Preparing content for analysis...</p>';

        // 2. Get all news content
        const allNewsContainers = document.querySelectorAll('.news-grid-container .news-grid');
        let htmlContent = '';
        allNewsContainers.forEach(container => {
            htmlContent += container.innerHTML;
        });

        if (!htmlContent.trim()) {
            summaryHeader.innerHTML = '‚ö†Ô∏è **Cannot Generate Summary**';
            summaryContent.innerHTML = '<p>No content loaded to summarize.</p>';
            return;
        }

        // 3. Make the API Call (Sending the promptType)
        try {
            const response = await fetch('/api/summarize-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    htmlContent: htmlContent,
                    promptType: summaryPromptType // <-- NEW FIELD SENT TO SERVER
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            
            // 4. Update the UI
            summaryHeader.innerHTML = data.header;
            
            // Render Markdown content
            const renderedHtml = DOMPurify.sanitize(marked.parse(data.summary));
            summaryContent.innerHTML = renderedHtml;
            
            // Enable copy button
            copyButton.disabled = false;

        } catch (error) {
            console.error("AI Proxy Error:", error.message);
            summaryHeader.innerHTML = '‚ùå **AI Summary Failed**';
            summaryContent.innerHTML = `<p class="error-message">AI Proxy Error: ${error.message}</p>`;
            copyButton.disabled = true;
        }
    }


    // The filterCards function (Keep your original logic)
    function filterCards() {
        const input = document.getElementById('search-input');
        const filter = input.value.toUpperCase();
        const cards = document.querySelectorAll('.news-card:not(.hidden)');

        cards.forEach(card => {
            const title = card.querySelector('h3').textContent.toUpperCase();
            const description = card.querySelector('p').textContent.toUpperCase();
            const source = card.querySelector('.card-source').textContent.toUpperCase();

            if (title.includes(filter) || description.includes(filter) || source.includes(filter)) {
                card.style.display = "";
            } else {
                card.style.display = "none";
            }
        });
    }

    // The toggleSection function (Keep your original logic)
    function toggleSection(button) {
        const targetId = button.getAttribute('data-target');
        const targetSection = document.getElementById(targetId);

        if (targetSection.style.display === 'none') {
            targetSection.style.display = 'block';
            button.classList.add('active');
        } else {
            targetSection.style.display = 'none';
            button.classList.remove('active');
        }
    }

    // The toggleTheme function (Keep your original logic)
    function toggleTheme() {
        const body = document.body;
        const toggleButton = document.getElementById('theme-toggle');
        body.classList.toggle('dark-mode');
        
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark');
            toggleButton.innerHTML = 'üåô Switch to Light Mode';
        } else {
            localStorage.setItem('theme', 'light');
            toggleButton.innerHTML = '‚òÄÔ∏è Switch to Dark Mode';
        }
    }

    // The checkInitialTheme function (Keep your original logic)
    function checkInitialTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').innerHTML = 'üåô Switch to Light Mode';
        }
    }

    // The setListView function (Keep your original logic)
    function setListView(view) {
        const containers = document.querySelectorAll('.news-grid-container');
        const gridButton = document.getElementById('grid-view-button');
        const listButton = document.getElementById('list-view-button');
        
        containers.forEach(container => {
            const grid = container.querySelector('.news-grid');
            if (view === 'list') {
                grid.classList.add('list-view');
            } else {
                grid.classList.remove('list-view');
            }
        });
        
        if (view === 'list') {
            listButton.classList.add('active');
            gridButton.classList.remove('active');
            localStorage.setItem('viewMode', 'list');
        } else {
            gridButton.classList.add('active');
            listButton.classList.remove('active');
            localStorage.setItem('viewMode', 'grid');
        }
        
        // Apply initial view mode on load
        if (localStorage.getItem('viewMode') === 'list') {
            setListView('list');
        } else {
            setListView('grid');
        }
    }

    // The toggleFilterBar function (Keep your original logic)
    function toggleFilterBar() {
        const filterBar = document.getElementById('filter-bar-container');
        const button = document.getElementById('toggle-filter-bar-btn');

        if (filterBar.style.display === 'none') {
            filterBar.style.display = 'flex';
            button.textContent = 'Hide Filter Bar';
        } else {
            filterBar.style.display = 'none';
            button.textContent = 'Show Filter Bar';
        }
    }

    // The hideTile function (Keep your original logic)
    function hideTile(element) {
        const uid = element.getAttribute('data-uid');
        if (uid) {
            localStorage.setItem('hidden-' + uid, 'true');
            element.classList.add('hidden');
            element.style.display = 'none'; // Also visually hide immediately
        }
    }

    // The loadHiddenTiles function (Keep your original logic)
    function loadHiddenTiles() {
        const cards = document.querySelectorAll('.news-card');
        cards.forEach(card => {
            const uid = card.getAttribute('data-uid');
            if (uid && localStorage.getItem('hidden-' + uid) === 'true') {
                card.classList.add('hidden');
                card.style.display = 'none';
            }
        });
    }

    // The resetHiddenTiles function (Keep your original logic)
    function resetHiddenTiles() {
        // Clear all 'hidden-' items from local storage
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('hidden-')) {
                localStorage.removeItem(key);
            }
        });

        // Show all currently hidden cards
        document.querySelectorAll('.news-card.hidden').forEach(card => {
            card.classList.remove('hidden');
            card.style.display = ''; // Reset display style
        });
    }

    // The copyAISummary function (Keep your original logic)
    function copyAISummary() {
        const summaryContent = document.getElementById('ai-summary-content').innerText;
        navigator.clipboard.writeText(summaryContent).then(() => {
            const button = document.getElementById('copy-summary-button');
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = 'Copy Summary';
            }, 2000);
        }).catch(err => {
            console.error('Could not copy text: ', err);
            alert('Failed to copy summary to clipboard.');
        });
    }
</script>
</body>
</html>
